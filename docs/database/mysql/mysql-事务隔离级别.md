
> æœ¬æ–‡ç”± [SnailClimb](https://github.com/Snailclimb) å’Œ [guang19](https://github.com/guang19) å…±åŒå®Œæˆ



### ä»€ä¹ˆæ˜¯äº‹åŠ¡

äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œ**è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ**ã€‚

äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼šå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒï¼Œå°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒã€‚ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚



### äº‹åŠ¡çš„ç‰¹æ€§(ACID)

![äº‹åŠ¡çš„ç‰¹æ€§](https://img-note.langyastudio.com/202111301710248.png?x-oss-process=style/watermark)

**åŸå­æ€§ï¼š** äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›

**ä¸€è‡´æ€§ï¼š** æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚è½¬è´¦ä¸šåŠ¡ä¸­ï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œè½¬è´¦è€…å’Œæ”¶æ¬¾äººçš„æ€»é¢åº”è¯¥æ˜¯ä¸å˜çš„ï¼›

**éš”ç¦»æ€§ï¼š** å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›

**æŒä¹…æ€§ï¼š** ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚

MySQL InnoDB å¼•æ“ä½¿ç”¨ **redo log(é‡åšæ—¥å¿—)** ä¿è¯äº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œä½¿ç”¨ **undo log(å›æ»šæ—¥å¿—)** æ¥ä¿è¯äº‹åŠ¡çš„**åŸå­æ€§**ã€‚

MySQL InnoDB å¼•æ“é€šè¿‡ **é”æœºåˆ¶**ã€**MVCC** ç­‰æ‰‹æ®µæ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆ é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **`REPEATABLE-READ`** ï¼‰ã€‚

ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚



### å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜

åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹ç»Ÿä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚

- **è„è¯»ï¼ˆDirty readï¼‰:** å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§**ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤**åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„

- **ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰:** æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚	ä¾‹å¦‚ï¼šäº‹åŠ¡1è¯»å–æŸè¡¨ä¸­çš„æ•°æ®A=20ï¼Œäº‹åŠ¡2ä¹Ÿè¯»å–A=20ï¼Œäº‹åŠ¡1ä¿®æ”¹A=A-1ï¼Œäº‹åŠ¡2ä¹Ÿä¿®æ”¹A=A-1ï¼Œæœ€ç»ˆç»“æœA=19ï¼Œäº‹åŠ¡1çš„ä¿®æ”¹è¢«ä¸¢å¤±

- **ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatablereadï¼‰:** æŒ‡åœ¨ä¸€ä¸ª**äº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®**ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»

- **å¹»è¯»ï¼ˆPhantom readï¼‰:** å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»

  

**ä¸å¯é‡å¤åº¦å’Œå¹»è¯»åŒºåˆ«ï¼š**

ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯**ä¿®æ”¹**ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äº**æ–°å¢æˆ–è€…åˆ é™¤**ã€‚

ä¾‹1ï¼ˆåŒæ ·çš„æ¡ä»¶, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘ç°å€¼ä¸ä¸€æ ·äº† ï¼‰ï¼šäº‹åŠ¡1ä¸­çš„Aå…ˆç”Ÿè¯»å–è‡ªå·±çš„å·¥èµ„ä¸º 1000 çš„æ“ä½œè¿˜æ²¡å®Œæˆï¼Œäº‹åŠ¡2ä¸­çš„Bå…ˆç”Ÿå°±ä¿®æ”¹äº†Açš„å·¥èµ„ä¸º 2000ï¼Œå¯¼è‡´Aå†è¯»è‡ªå·±çš„å·¥èµ„æ—¶å·¥èµ„å˜ä¸º  2000ï¼›è¿™å°±æ˜¯ä¸å¯é‡å¤è¯»

 ä¾‹2ï¼ˆåŒæ ·çš„æ¡ä»¶, ç¬¬1æ¬¡å’Œç¬¬2æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ · ï¼‰ï¼šå‡æŸå·¥èµ„å•è¡¨ä¸­å·¥èµ„å¤§äº3000çš„æœ‰4äººï¼Œäº‹åŠ¡1è¯»å–äº†æ‰€æœ‰å·¥èµ„å¤§äº3000çš„äººï¼Œå…±æŸ¥åˆ°4æ¡è®°å½•ï¼Œè¿™æ—¶äº‹åŠ¡2åˆæ’å…¥äº†ä¸€æ¡å·¥èµ„å¤§äº3000çš„è®°å½•ï¼Œäº‹åŠ¡1å†æ¬¡è¯»å–æ—¶æŸ¥åˆ°çš„è®°å½•å°±å˜ä¸ºäº†5æ¡ï¼Œè¿™æ ·å°±å¯¼è‡´äº†å¹»è¯»ã€‚



### äº‹åŠ¡éš”ç¦»çº§åˆ«

**SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š**

- **READ-UNCOMMITTED(è¯»å–æœªæäº¤)**ï¼š æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»
- **READ-COMMITTED(è¯»å–å·²æäº¤)**ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ
- **REPEATABLE-READ(å¯é‡å¤è¯»)**ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ
- **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)**ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»

----

| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» |
| :---: | :---: | :---:| :---: |
| READ-UNCOMMITTED | âˆš | âˆš | âˆš |
| READ-COMMITTED | Ã— | âˆš | âˆš |
| REPEATABLE-READ | Ã— | Ã— | âˆš |
| SERIALIZABLE | Ã— | Ã— | Ã— |



MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰**ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`SELECT @@tx_isolation;`å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º`SELECT @@transaction_isolation;`

```sql
mysql> SELECT @@tx_isolation;
+-----------------+
| @@tx_isolation  |
+-----------------+
| REPEATABLE-READ |
+-----------------+
```

**MySQL InnoDB çš„ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰å¹¶ä¸ä¿è¯é¿å…å¹»è¯»ï¼Œéœ€è¦åº”ç”¨ä½¿ç”¨åŠ é”è¯»æ¥ä¿è¯ã€‚è€Œè¿™ä¸ªåŠ é”åº¦ä½¿ç”¨åˆ°çš„æœºåˆ¶å°±æ˜¯ Next-Key Locksã€‚**



å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯ **READ-COMMITTED(è¯»å–æäº¤å†…å®¹)** ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰** å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚

InnoDB å­˜å‚¨å¼•æ“åœ¨ **åˆ†å¸ƒå¼äº‹åŠ¡** çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ° **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)** éš”ç¦»çº§åˆ«ã€‚

ğŸŒˆ æ‹“å±•ä¸€ä¸‹(ä»¥ä¸‹å†…å®¹æ‘˜è‡ªã€ŠMySQL æŠ€æœ¯å†…å¹•ï¼šInnoDB å­˜å‚¨å¼•æ“(ç¬¬ 2 ç‰ˆ)ã€‹7.7 ç« )ï¼š

> InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å¯¹ XA äº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶é€šè¿‡ XA äº‹åŠ¡æ¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯å…è®¸å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡èµ„æºï¼ˆtransactional resourcesï¼‰å‚ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„äº‹åŠ¡ä¸­ã€‚äº‹åŠ¡èµ„æºé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„èµ„æºã€‚å…¨å±€äº‹åŠ¡è¦æ±‚åœ¨å…¶ä¸­çš„æ‰€æœ‰å‚ä¸çš„äº‹åŠ¡è¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½å›æ»šï¼Œè¿™å¯¹äºäº‹åŠ¡åŸæœ‰çš„ ACID è¦æ±‚åˆæœ‰äº†æé«˜ã€‚å¦å¤–ï¼Œåœ¨ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å¿…é¡»è®¾ç½®ä¸º SERIALIZABLEã€‚



### å®é™…æƒ…å†µæ¼”ç¤º

åœ¨ä¸‹é¢æˆ‘ä¼šä½¿ç”¨ 2 ä¸ªå‘½ä»¤è¡Œmysql ï¼Œæ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼ˆå¤šäº‹åŠ¡ï¼‰å¯¹åŒä¸€ä»½æ•°æ®çš„è„è¯»é—®é¢˜ã€‚

MySQL å‘½ä»¤è¡Œçš„é»˜è®¤é…ç½®ä¸­äº‹åŠ¡éƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œå³æ‰§è¡ŒSQLè¯­å¥åå°±ä¼šé©¬ä¸Šæ‰§è¡Œ COMMIT æ“ä½œã€‚å¦‚æœè¦æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä½¿ç”¨å‘½ä»¤ï¼š`START TARNSACTION`ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®éš”ç¦»çº§åˆ«ã€‚

```sql
SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE]
```

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨ä¸‹é¢å®é™…æ“ä½œä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›å¹¶å‘æ§åˆ¶è¯­å¥:

- `START TARNSACTION` |`BEGIN`ï¼šæ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚
- `COMMIT`ï¼šæäº¤äº‹åŠ¡ï¼Œä½¿å¾—å¯¹æ•°æ®åº“åšçš„æ‰€æœ‰ä¿®æ”¹æˆä¸ºæ°¸ä¹…æ€§ã€‚
- `ROLLBACK`ï¼šå›æ»šä¼šç»“æŸç”¨æˆ·çš„äº‹åŠ¡ï¼Œå¹¶æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ã€‚



#### è„è¯»(è¯»æœªæäº¤)

![](https://img-note.langyastudio.com/202111301711748.jpeg?x-oss-process=style/watermark)



#### é¿å…è„è¯»(è¯»å·²æäº¤)

![](https://img-note.langyastudio.com/202111301711707.jpeg?x-oss-process=style/watermark)



#### ä¸å¯é‡å¤è¯»

è¿˜æ˜¯åˆšæ‰ä¸Šé¢çš„è¯»å·²æäº¤çš„å›¾ï¼Œè™½ç„¶é¿å…äº†è¯»æœªæäº¤ï¼Œä½†æ˜¯å´å‡ºç°äº†ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸï¼Œå°±å‘ç”Ÿäº† ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚

![](https://img-note.langyastudio.com/202111301715777.jpeg?x-oss-process=style/watermark)



#### å¯é‡å¤è¯»

![](https://img-note.langyastudio.com/202111301712322.jpeg?x-oss-process=style/watermark)



#### é˜²æ­¢å¹»è¯»(å¯é‡å¤è¯»)

![](https://img-note.langyastudio.com/202111301712877.jpeg?x-oss-process=style/watermark)



ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œè¿™ç§æ“ä½œçš„èŒƒå›´æ˜¯æ•°æ®åº“çš„å…¨éƒ¨è¡Œï¼Œç„¶åç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿåœ¨å¯¹è¿™ä¸ªæ•°æ®åº“æ“ä½œï¼Œè¿™ç§æ“ä½œå¯ä»¥æ˜¯æ’å…¥ä¸€è¡Œè®°å½•æˆ–åˆ é™¤ä¸€è¡Œè®°å½•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ˜¯äº‹åŠ¡å°±ä¼šè§‰å¾—è‡ªå·±å‡ºç°äº†å¹»è§‰ï¼Œæ€ä¹ˆè¿˜æœ‰æ²¡æœ‰å¤„ç†çš„è®°å½•å‘¢? æˆ–è€… æ€ä¹ˆå¤šå¤„ç†äº†ä¸€è¡Œè®°å½•å‘¢?



##### è§£å†³å¹»è¯»çš„æ–¹æ³•

è§£å†³å¹»è¯»çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å®ƒä»¬çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨æ“ä½œæŸå¼ è¡¨æ•°æ®çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸å…è®¸æ–°å¢æˆ–è€…åˆ é™¤è¿™å¼ è¡¨ä¸­çš„æ•°æ®äº†ã€‚è§£å†³å¹»è¯»çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š

1. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è°ƒæ•´ä¸º `SERIALIZABLE`
2. åœ¨å¯é‡å¤è¯»çš„äº‹åŠ¡çº§åˆ«ä¸‹ï¼Œç»™äº‹åŠ¡æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ è¡¨é”
3. åœ¨å¯é‡å¤è¯»çš„äº‹åŠ¡çº§åˆ«ä¸‹ï¼Œç»™äº‹åŠ¡æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ  `Next-Key Locks`

> è¯´æ˜ï¼š`Next-Key Locks` ç›¸å½“äº è¡Œé” + é—´éš™é”



### å‚è€ƒ

- ã€ŠMySQLæŠ€æœ¯å†…å¹•ï¼šInnoDBå­˜å‚¨å¼•æ“ã€‹
- <https://dev.mysql.com/doc/refman/5.7/en/>
- [Mysql é”ï¼šçµé­‚ä¸ƒæ‹·é—®](https://tech.youzan.com/seven-questions-about-the-lock-of-mysql/)
- [Innodb ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œé”çš„å…³ç³»](https://tech.meituan.com/2014/08/20/innodb-lock.html)
